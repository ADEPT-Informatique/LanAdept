@model LanAdept.Views.Tournament.ModelController.TournamentModel
@using LanAdept.Views.Tournament.ModelController;


@{
    bool isConnected = LanAdeptCore.Service.UserService.GetLoggedInUser() != null;
    ViewBag.Title = "Details";
}
<div class="map-max-width">
    @if (isConnected)
    {
        <div class="page-header clearfix">
            <h1 class="pull-left">@Html.DisplayFor(model => model.Game.Name)</h1>
            <div class="btn-toolbar pull-right">
                <div class="btn-group">
                    @Html.ActionLink("Ajouter une equipe", "AddTeam", new { id = Model.TournamentID }, new { @class = "btn btn-default" })
                </div>
            </div>
        </div>
    }

    <h4>Teams</h4>
    <table class="table">
        <tr>
            <th>@Html.DisplayNameFor(model => model.Teams.First().Name)</th>
            <th>@Html.DisplayNameFor(model => model.Teams.First().Tag)</th>
            <th>Nombre de joueur</th>
            <th>Membre de l'équipe</th>
            @if (isConnected)
            {
                <th></th>
            }
        </tr>

        @foreach (Team team in Model.Teams)
        {
            <tr>
                <td>
                    @team.Name.ToString()
                </td>
                <td>
                    @if (team.Tag != null)
                    {
                        @team.Tag.ToString()
                    }
                </td>
                <td>
                    @team.GamerTags.Count.ToString() / @team.Tournament.MaxPlayerPerTeam
                </td>
                <td>
                    @foreach (var tag in team.GamerTags)
                    {
                        <div class="col-xs-12">@tag.Gamertag</div>
                    }
                </td>
                @if (isConnected)
                {
                    <td>
                        <div class="btn-group">
                            @Html.ActionLink("Rejoindre", "JoinTeam", "Tournament", new JoinTeamModel { TournamentID = Model.TournamentID, TeamID = team.TeamID }, new { @class = "teamButton btn btn-default" })
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu">
                                @foreach (var gamerTags in Model.GamerTags)
                                {
                                    <li><a href="#" data-tagid="@gamerTags.GamerTagID"><span></span>@gamerTags.Gamertag</a></li>
                                }
                                <li role="separator" class="divider"></li>
                                <li>
                                    @using(Html.BeginForm("AddGamerTag", "Tournament", new GamerTagModel() { TournamentID = Model.TournamentID }, FormMethod.Post))
                                    {
                                        <div class="col-lg-12">
                                            <div class="input-group input-group-sm">
                                                @Html.Editor("Gamertag")
                                                @*<input type="text" class="form-control" placeholder="Search for...">*@
                                                <span class="input-group-btn">
                                                    <button class="btn btn-default" type="submit">+</button>
                                                </span>
                                            </div>
                                        </div>   
                                    }
                                </li>
                            </ul>
                        </div>
                    </td>
                }
            </tr>
        }
    </table>
</div>

@section scripts {
    <script>
        $(document).ready(function(){
            
            var gamerTagId = 0;

            $('.teamButton').click(function (event) {
                if (gamerTagId == 0) event.preventDefault();
                else
                {
                    var url = $(this).attr('href');
                    url += '&GamerTagId=' + gamerTagId;
                    $(this).attr('href', url);
                }
            })

            $('.dropdown-menu li a').click(function () {
                gamerTagId = $(this).attr('data-tagid')
                $('.selectedTag').removeClass('selectedTag glyphicon glyphicon-ok');
                var attr = 'ul li a[data-tagid=' + gamerTagId + ']';
                $(attr).children('span').addClass('selectedTag glyphicon glyphicon-ok')
            })

        })
    </script>
}
