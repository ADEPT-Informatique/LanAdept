@model LanAdept.Views.Tournament.ModelController.TournamentModel
@using LanAdept.Views.Tournament.ModelController;


@{
	bool isConnected = LanAdeptCore.Service.UserService.GetLoggedInUser() != null;
	ViewBag.Title = "Details";
}
<div class="map-max-width">
	@if (isConnected)
	{
		<div class="page-header clearfix">
			<h1 class="pull-left">@Html.DisplayFor(model => model.Game.Name)</h1>
			<div class="btn-toolbar pull-right">
				<div class="btn-group">
					@Html.ActionLink("Ajouter une equipe", "AddTeam", new { id = Model.TournamentID }, new { @class = "btn btn-default" })
				</div>
			</div>
		</div>
	}

	<h4>Teams</h4>

	@using (Html.BeginForm("JoinTeam", "Tournament", new JoinTeamModel() { TournamentID = Model.TournamentID }))
	{
		@Html.Hidden("GamerTagID", 0, new { id = "tagInput" })
		@Html.Hidden("TeamID", 0, new { id = "teamInput" })
		
		if (isConnected)
		{
			@Html.Partial("ModalRejoindreGamerTag", Model.GamerTags)
		}
		
		<table class="table">
			<tr>
				<th>@Html.DisplayNameFor(model => model.Teams.First().Name)</th>
				<th>@Html.DisplayNameFor(model => model.Teams.First().Tag)</th>
				<th>Nombre de joueur</th>
				<th>Membre de l'équipe</th>
				@if (isConnected)
				{
					<th></th>
				}
			</tr>

			@foreach (Team team in Model.Teams)
			{
				<tr>
					<td>
						@team.Name
					</td>
					<td>
						@if (team.Tag != null)
						{
							@team.Tag
						}
					</td>
					<td>
						@team.GamerTags.Count / @team.Tournament.MaxPlayerPerTeam
					</td>
					<td>
						@foreach (var tag in team.GamerTags)
						{
							<div class="col-xs-12">@tag.Gamertag</div>
						}
					</td>
					@if (isConnected)
					{
						<td>
							<div class="col-md-6 pull-right">
								<button class="teamButton hover btn btn-default" type="button" data-toggle="modal" data-team-id="@team.TeamID" data-target="#ModalChoisirGamerTag">Rejoindre</button>
							</div>
						</td>
					}
				</tr>
			}
		</table>
	}
</div>

@section scripts {
	<script>
		$(document).ready(function () {

			$('.teamButton').click(function () {
				$('.teamActive').removeClass('teamActive');
				$(this).addClass('teamActive');
			})

			$('.btnAjouter').click(function () {
				$('#teamInput').val($('.teamActive').attr('data-team-id'));
				$('#tagInput').val($('.active').attr('data-tag-id'));
			})

			$('.tagItem').click(function (event) {
				$('#GamerTagID').val($(this).attr('data-tag-id'));
				$('.active').removeClass('active');
				$(this).addClass('active')
			})

			$('.addGamertag').click(function (event) {
				$.ajax({
					method: "POST",
					url: "@Url.Action("AddGamerTag")",
					data: { gamertag: $('#gamerTagText').val() }
				}).done(function (data) {
					console.log(data);
					$('.tagItem:last').after('<a href="#" class="tagItem list-group-item" data-tag-id="' + data.GamerTagID + '">' + data.Gamertag + '</a>')
				})
			})

			$('#ModalChoisirGamerTag').on('show.bs.modal', function (event) {
				var button = $(event.relatedTarget);
				var modal = $(this);
			})
		})
	</script>
}

